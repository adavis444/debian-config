#!/bin/sh

## Prepare folders to share with Linux
# Open Files app
# For each [My files/Downloads, Google Drive/My Drive, sd]:
# 	Right click
# 	Share with Linux

## Clone configuration files from GitHub
# 	git clone https://github.com/adavis444/debian-config.git
# Execute this script:
# 	sudo sh "$HOME/debian-config/set-up-chromebook-linux"

sudo apt full-upgrade -y
sudo apt install -y coreutils sudo git
function gitPullIfExistsElseClone {
	if [ -d $2 ]; then
		cd $2
		git pull $1
		cd -
	else
		git clone $1 $2
	fi
}

gitPullIfExistsElseClone "https://github.com/adavis444/debian-config.git" \
	"$HOME/debian-config"

## Overwrite default hidden files with available soft links
for f in $(ls -ap "$HOME/debian-config" | grep "^\..*[^/]$")
do
	ln -sf "$HOME/debian-config/$f" "$HOME/$f"
done

## Link Chromebook folders to Linux home directory
sudo ln -sf /mnt/chromeos/GoogleDrive/MyDrive "$HOME/google-drive"
sudo ln -sf /mnt/chromeos/MyFiles/Downloads "$HOME/downloads"
sudo ln -sf /mnt/chromeos/removable/sd "$HOME/sd"

## Install packages from apt
sudo apt install -y $(cat "$HOME/debian-config/apt-packages" | tr "\n" " ")

## Install node, npm, & yarn
curl -sL https://deb.nodesource.com/setup_12.x | sudo bash -
curl -sL https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
echo "deb https://dl.yarnpkg.com/debian/ stable main" \
	| sudo tee /etc/apt/sources.list.d/yarn.list
sudo apt-get update
sudo apt install -y nodejs yarn

## Set up vim with Vundle and YouCompleteMe
gitPullIfExistsElseClone "https://github.com/VundleVim/Vundle.vim.git" \
	"$HOME/.vim/bundle/Vundle.vim"
vim +PluginInstall +qall
python3 "$HOME/.vim/bundle/YouCompleteMe/install.py" \
	--clangd-completer --ts-completer --rust-completer

## Install python and pyenv
gitPullIfExistsElseClone "https://github.com/pyenv/pyenv.git" \
	"$HOME/.pyenv"
exec "$SHELL"
pyenv install 3.7.5
pyenv global 3.7.5
pip install --upgrade pip numpy pandas requests

## Install pyenv-virtualenv
#gitPullIfExistsElseClone "https://github.com/pyenv/pyenv-virtualenv.git" \
#	"$HOME/.pyenv/plugins/pyenv-virtualenv"
#
# Enable the following line in .bashrc:
#	eval "$(pyenv virtualenv-init -)"
#exec "$SHELL"
